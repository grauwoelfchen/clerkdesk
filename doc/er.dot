digraph Clerkdesk {
  /**
   * Style
   *
   */

  graph [fontname = "DejaVuSansMono"; fontsize = 9];
  node  [fontname = "DejaVuSansMono"; fontsize = 9];
  edge  [fontname = "DejaVuSansMono"; fontsize = 9];

  /**
   * Node
   *
   */

  node [ // object
    shape   = record
    rankdir = LR
  ]

  LockerRoomAccount [
    label = "{locker_room_accounts|«LockerRoom::Account»\lhas_many: locker_roommembers\lhas_many: locker_room_users\l\n|{ \
      {FIELD|\l}| \
      {TYPE|\l}| \
      {VALUE|\r} \
    }}"
    style     = "filled"
    fontcolor = "black"
    fillcolor = "azure2"
  ]

  LockerRoomUser [
    label = "{locker_room_users|«LockerRoom::User»\lbelongs_to: locker_room_account\lhas_one: locker_room_member\lhas_one: person\l\n|{ \
      {FIELD|\l}| \
      {TYPE|\l}| \
      {VALUE|\r} \
    }}"
    style     = "filled"
    fontcolor = "black"
    fillcolor = "azure2"
  ]

  LockerRoomMember [
    label = "{locker_room_members|«LockerRoom::Member»\lbelongs_to: locker_room_account\lbelongs_to: locker_room_user\l\n|{ \
      {FIELD|\l}| \
      {TYPE|\l}| \
      {VALUE|\r} \
    }}"
    style     = "filled"
    fontcolor = "black"
    fillcolor = "azure2"
  ]

  Tag [
    label = "{tags|«ActsAsTaggableOn::Tag»\lhas_many: taggins\l\n|{ \
      {FIELD|\l}| \
      {TYPE|\l}| \
      {VALUE|\r} \
    }}"
    style     = "filled"
    fontcolor = "black"
    fillcolor = "floralwhite"
  ]

  Tagging [
    label = "{taggings|«ActsAsTaggableOn::Tagging»\lbelongs_to: tag\lbelongs_to: note\lbelongs_to: entry\l\n|{ \
      {FIELD|\l}| \
      {TYPE|\l}| \
      {VALUE|\r} \
    }}"
    style     = "filled"
    fontcolor = "black"
    fillcolor = "floralwhite"
  ]

  Note [
    label = "{notes|«Note»\lhas_many: tags\lhas_many: involvements (as concerns)\n|{ \
      {FIELD|title\l|content\l}| \
      {TYPE|varchar\l|text\l}| \
      {VALUE|\r|\r} \
    }}"
  ]

  Account [
    label = "{accounts|«Account»\lhas_one: budget\lhas_one: settlement\l\n|{ \
      {FIELD|name\l|description\l|started_at\l|finished_at\l|status\l}| \
      {TYPE|varchar\l|text\l|datetime\l|datetime\l|integer\l}| \
      {VALUE|\r|\r|\r|\r|\r} \
    }}"
  ]


  AccountCategory [
    label = "{account_categories|«AccountCategory»\lbelongs_to: account\lhas_many: ledger_entries (th. journalizings, as entries)\l\n|{ \
      {FIELD|account_id\l|type\l|name\l}| \
      {TYPE|integer\l|integer\l|name\l}| \
      {VALUE|\r|0:expense,1:income\r|\r} \
    }}"
  ]

  Budget [
    label = "{budgets|«Budget»\lbelongs_to: account\l\n|{ \
      {FIELD|account_id\l|title\l|description\l|carryover\l|approved_at\l}| \
      {TYPE|integer\l|varchar\l|text\l|integer\l|datetime}| \
      {VALUE|\r|\r|\r|default:0\r|\r} \
    }}"
  ]

  Settlement [
    label = "{settlements|«Settlement»\lbelongs_to: account\l\n|{ \
      {FIELD|account_id\l|title\l|description\l|carryover\l|approved_at\l}| \
      {TYPE|integer\l|varchar\l|text\l|integer\l|datetime}| \
      {VALUE|\r|\r|\r|default:0\r|\r} \
    }}"
  ]

  Ledger [
    label = "{ledgers|«Ledger»\lbelongs_to: account\lhas_many: ledger_entries (as entries)\l\n|{ \
      {FIELD|account_id\l|title\l|description\l}| \
      {TYPE|integer\l|varchar\l|text\l}| \
      {VALUE|\r|\r|\r} \
    }}"
  ]

  Journalizing [
    label = "{journalizings|«Journalizing»\lbelongs_to: account_category (as category)\lbelongs_to: ledger_entry: (as entry)\l\n|{ \
      {FIELD|entry_id\l|category_id\l|entries_count\l}| \
      {TYPE|integer\l|integer\l|integer\l}| \
      {VALUE|\r|\r|default:0\r} \
    }}"
  ]

  LedgerEntry [
    label = "{ledger_entries|«LedgerEntry»\lbelongs_to: ledger\lhas_one: account_category (th. journalizing, as category)\lhas_many: ledger_items (as items)\lhas_many: tags\lhas_many: involvements (as concerns)\l\n|{ \
      {FIELD|ledger_id\l|category_id\l|type\l|title\l|amount\l|memo\l}| \
      {TYPE|integer\l|integer\l|integer\l|varchar\l|varchar\l|varchar\l}| \
      {VALUE|\r|\r|0:expense,1:income\r|\r|\r|\r} \
    }}"
  ]

  LedgerItem [
    label = "{ledger_items|«LedgerItem»\lbelongs_to: ledger_entry (as entry)\l\n|{ \
      {FIELD|entry_id\l|name\l|amount\l|memo\l}| \
      {TYPE|integer\l|varchar\l|varchar\l|varchar\l}| \
      {VALUE|\r|\r|\r|\r} \
    }}"
  ]

  Involvement [
    label = "{involvements|«Involvement»\lbelongs_to: person\lbelongs_to: concern\l\n|{ \
      {FIELD|person_id\l|concern_id\l|concern_type\l}| \
      {TYPE|integer\l|integer\l|varchar\l}| \
      {VALUE|\r|\r|\r} \
    }}"
  ]

  Person [
    label = "{people|«Person»\lhas_one: locker_room_user (as user)\lhas_many: involvements (as concerns)\l\n|{ \
      {FIELD|identifier\l|name\l|zip_code\l|address\l|phone\l|email\l}| \
      {TYPE|varchar\l|varchar\l|varchar\l|text\l|varchar\l|varchar\l}| \
      {VALUE|\r|\r|\r|\r|\r|\r} \
    }}"
  ]

  edge [ // table
    shape   = record
    rankdir = LR
  ]

  UserPerson [
    label = "{users_people|{ \
      {FIELD|user_id\l|person_id\l}| \
      {TYPE|integer\l|integer\l}| \
      {VALUE|\r|\r} \
    }}"
    style     = "filled"
    fontcolor = "black"
    fillcolor = "cornsilk3"
  ]


  /**
   * Relation
   *
   */

  edge [ // has_many
    arrowhead = crow
    arrowtail = none
    headlabel = ""
    taillabel = ""
    dir       = both
  ]

  //Account -> Member
  //Account -> User

  Note        -> Tag
  LedgerEntry -> Tag

  edge [ // belongs_to
    arrowhead = vee
    arrowtail = none
    headlabel = ""
    taillabel = ""
    dir       = both
  ]

  LockerRoomMember -> LockerRoomAccount
  LockerRoomMember -> LockerRoomUser
  LockerRoomUser   -> LockerRoomAccount

  Tagging -> Tag
  Tagging -> Note
  Tagging -> LedgerEntry

  Budget     -> Account
  Settlement -> Account
  AccountCategory -> Account

  Ledger      -> Account
  LedgerEntry -> Ledger
  LedgerItem  -> LedgerEntry

  Journalizing -> AccountCategory
  Journalizing -> LedgerEntry

  Involvement -> Person
  Involvement -> Note
  Involvement -> LedgerEntry

  edge [ // has_one
    arrowhead = normal
    arrowtail = none
    headlabel = ""
    taillabel = ""
    dir       = both
  ]

  edge [ // has_and_belongs_to_many
    arrowhead = crow
    arrowtail = vee
    headlabel = ""
    taillabel = ""
    dir       = both
  ]

  edge [
    arrowhead = none
    arrowtail = none
    headlabel = ""
    taillabel = ""
    dir       = both
  ]

  LockerRoomUser -> UserPerson
  Person         -> UserPerson


  /**
   * Layout
   *
   */

  {rank = same; LockerRoomMember;};
  {rank = same; LockerRoomAccount; LockerRoomUser; Person};
  {rank = same; Note; Involvement; Account;};
  {rank = same; Budget; Settlement;};
  {rank = same; Involvement;};
  {rank = same; Tagging; LedgerEntry;AccountCategory;};
  {rank = same; Tag; Ledger;};
}
