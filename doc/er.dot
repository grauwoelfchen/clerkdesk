digraph Clerkdesk {
  /**
   * Style
   *
   */

  graph [fontname = "DejaVuSansMono"; fontsize = 9];
  node  [fontname = "DejaVuSansMono"; fontsize = 9];
  edge  [fontname = "DejaVuSansMono"; fontsize = 9];

  /**
   * Node
   *
   */

  node [ // object
    shape   = record
    rankdir = LR
  ]

  LockerRoomAccount [
    label = "{locker_room_accounts|«LockerRoom::Account»\lhas_many: locker_roommembers\lhas_many: locker_room_users\l\n|{ \
      {FIELD|\l}| \
      {TYPE|\l}| \
      {VALUE|\l} \
    }}"
    style     = "filled"
    fontcolor = "black"
    fillcolor = "azure2"
  ]

  LockerRoomUser [
    label = "{locker_room_users|«LockerRoom::User»\lbelongs_to: locker_room_account\lhas_one: locker_room_member\lhas_one: person\l\n|{ \
      {FIELD|\l}| \
      {TYPE|\l}| \
      {VALUE|\l} \
    }}"
    style     = "filled"
    fontcolor = "black"
    fillcolor = "azure2"
  ]

  LockerRoomMember [
    label = "{locker_room_members|«LockerRoom::Member»\lbelongs_to: locker_room_account\lbelongs_to: locker_room_user\l\n|{ \
      {FIELD|\l}| \
      {TYPE|\l}| \
      {VALUE|\l} \
    }}"
    style     = "filled"
    fontcolor = "black"
    fillcolor = "azure2"
  ]

  Tag [
    label = "{tags|«ActsAsTaggableOn::Tag»\lhas_many: taggins\l\n|{ \
      {FIELD|\l}| \
      {TYPE|\l}| \
      {VALUE|\l} \
    }}"
    style     = "filled"
    fontcolor = "black"
    fillcolor = "floralwhite"
  ]

  Tagging [
    label = "{taggings|«ActsAsTaggableOn::Tagging»\lbelongs_to: tag\lbelongs_to: note\lbelongs_to: entry\l\n|{ \
      {FIELD|\l}| \
      {TYPE|\l}| \
      {VALUE|\l} \
    }}"
    style     = "filled"
    fontcolor = "black"
    fillcolor = "floralwhite"
  ]

  Note [
    label = "{notes|«Note»\lhas_many: tags\lhas_many: involvements (as concerns)\n|{ \
      {FIELD|title\l|content\l}| \
      {TYPE|varchar\l|text\l}| \
      {VALUE|\l|\l} \
    }}"
  ]

  Finance [
    label = "{finances|«Finance»\lhas_one: budget\lhas_one: settlement\lhas_one: ledger\l\n|{ \
      {FIELD|name\l|description\l|started_at\l|finished_at\l|status\l}| \
      {TYPE|varchar\l|text\l|datetime\l|datetime\l|integer\l}| \
      {VALUE|\l|\l|\l|\l|\l} \
    }}"
  ]

  FinanceCategory [
    label = "{finance_categories|«FinanceCategory»\lbelongs_to: finance\lhas_many: ledger_entries (th. journalizings, as entries)\l\n|{ \
      {FIELD|finance_id\l|type\l|name\l}| \
      {TYPE|integer\l|integer\l|name\l}| \
      {VALUE|\l|0:expense,1:income\l|\l} \
    }}"
  ]

  Budget [
    label = "{budgets|«Budget»\lbelongs_to: finance\l\n|{ \
      {FIELD|finance_id\l|title\l|description\l|carryover\l|approved_at\l}| \
      {TYPE|integer\l|varchar\l|text\l|integer\l|datetime}| \
      {VALUE|\l|\l|\l|default:0\l|\l} \
    }}"
  ]

  Settlement [
    label = "{settlements|«Settlement»\lbelongs_to: finance\l\n|{ \
      {FIELD|finance_id\l|title\l|description\l|carryover\l|approved_at\l}| \
      {TYPE|integer\l|varchar\l|text\l|integer\l|datetime}| \
      {VALUE|\l|\l|\l|default:0\l|\l} \
    }}"
  ]

  Ledger [
    label = "{ledgers|«Ledger»\lbelongs_to: finance\lhas_many: ledger_entries (as entries)\l\n|{ \
      {FIELD|finance_id\l|title\l|description\l}| \
      {TYPE|integer\l|varchar\l|text\l}| \
      {VALUE|\l|\l|\l} \
    }}"
  ]

  Journalizing [
    label = "{journalizings|«Journalizing»\lbelongs_to: ledger\lbelongs_to: finance_category (as category)\lhas_many: ledger_entry: (as entry)\l\n|{ \
      {FIELD|ledger_id\l|category_id\l|entries_count\l}| \
      {TYPE|integer\l|integer\l|integer\l}| \
      {VALUE|\l|\l|default:0\l} \
    }}"
  ]

  LedgerEntry [
    label = "{ledger_entries|«LedgerEntry»\lbelongs_to: ledger\lbelongs_to: finace_category (th. journalizing, as category)\lhas_many: ledger_items (as items)\lhas_many: tags\lhas_many: involvements (as concerns)\l\n|{ \
      {FIELD|ledger_id\l|journalizing_id\l|type\l|title\l|total_amount\l|memo\l}| \
      {TYPE|integer\l|integer\l|integer\l|varchar\l|integer\l|varchar\l}| \
      {VALUE|\l|\l|0:expense,1:income\l|\l|\l|\l} \
    }}"
  ]

  LedgerItem [
    label = "{ledger_items|«LedgerItem»\lbelongs_to: ledger_entry (as entry)\l\n|{ \
      {FIELD|entry_id\l|name\l|amount\l|memo\l}| \
      {TYPE|integer\l|varchar\l|integer\l|varchar\l}| \
      {VALUE|\l|\l|\l|\l} \
    }}"
  ]

  Involvement [
    label = "{involvements|«Involvement»\lbelongs_to: person\lbelongs_to: concern\l\n|{ \
      {FIELD|person_id\l|concern_id\l|concern_type\l}| \
      {TYPE|integer\l|integer\l|varchar\l}| \
      {VALUE|\l|\l|\l} \
    }}"
  ]

  Person [
    label = "{people|«Person»\lhas_one: locker_room_user (as user)\lhas_many: involvements (as concerns)\l\n|{ \
      {FIELD|slug\l|property\l|first_name\l|last_name\l|postcode\l|country\l|division\l|city\l|address\l|phone\l|email\l|memo\l|joined_at\l|left_at\l}| \
      {TYPE|varchar\l|varchar\l|varchar\l|varchar\l|varchar\l|varchar\l|varchar\l|varchar\l|varchar\l|varchar\l|varchar\l|varchar\l|datetime\l|datetime\l}| \
      {VALUE|\l|\l|default:''\l|default:''\l|\l|default:''\l|default:''\l|default:''\l|default:''\l|\l|\l|\l|\l|\l} \
    }}"
  ]

  Identity [
    label = "{identities|«Identity»\lbelongs_to: locker_room (as user)\lbelongs_to: person\l\n|{ \
      {FIELD|user_id\l|person_id\l}| \
      {TYPE|integer\l|integer\l}| \
      {VALUE|\l|\l} \
    }}"
  ]

  edge [ // table
    shape   = record
    rankdir = LR
  ]

  // table [
  //   label = "{|{ \
  //     {FIELD|\l|\l}| \
  //     {TYPE|\l|\l}| \
  //     {VALUE|\l|\l} \
  //   }}"
  //   style     = "filled"
  //   fontcolor = "black"
  //   fillcolor = "cornsilk3"
  // ]

  /**
   * Relation
   *
   */

  edge [ // has_many
    arrowhead = crow
    arrowtail = none
    headlabel = ""
    taillabel = ""
    dir       = both
  ]

  //Account -> Member
  //Account -> User

  Note        -> Tag
  LedgerEntry -> Tag

  edge [ // belongs_to
    arrowhead = vee
    arrowtail = none
    headlabel = ""
    taillabel = ""
    dir       = both
  ]

  LockerRoomMember -> LockerRoomAccount
  LockerRoomMember -> LockerRoomUser
  LockerRoomUser   -> LockerRoomAccount

  Tagging -> Tag
  Tagging -> Note
  Tagging -> LedgerEntry

  Budget     -> Finance
  Settlement -> Finance
  FinanceCategory -> Finance

  Ledger      -> Finance
  LedgerEntry -> Ledger
  LedgerEntry -> Journalizing
  LedgerItem  -> LedgerEntry

  Journalizing -> Ledger
  Journalizing -> FinanceCategory

  Involvement -> Person
  Involvement -> Note
  Involvement -> LedgerEntry

  Identity -> LockerRoomUser
  Identity -> Person

  edge [ // has_one
    arrowhead = normal
    arrowtail = none
    headlabel = ""
    taillabel = ""
    dir       = both
  ]

  edge [ // has_and_belongs_to_many
    arrowhead = crow
    arrowtail = vee
    headlabel = ""
    taillabel = ""
    dir       = both
  ]

  edge [
    arrowhead = none
    arrowtail = none
    headlabel = ""
    taillabel = ""
    dir       = both
  ]


  /**
   * Layout
   *
   */

  {rank = same; LockerRoomMember;};
  {rank = same; LockerRoomAccount; LockerRoomUser; Person};
  {rank = same; Note; Involvement; Finance;};
  {rank = same; Budget; Settlement;};
  {rank = same; Involvement;};
  {rank = same; Tagging; LedgerEntry;FinanceCategory;};
  {rank = same; Tag; Ledger;};
}
